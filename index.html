<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>For CSDI use</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://api.tiles.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.js"></script>
    <link
      href="https://api.tiles.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Inter"
      rel="stylesheet"
    />
    <style>
      body {margin: 0; padding: 0;}
      #map {position: absolute; top: 0; bottom: 0; width: 100%;}
      .box {line-height: 0.9;}
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script>
      mapboxgl.accessToken = "pk.eyJ1IjoibmV3aXNsYW5kMTIyMyIsImEiOiJjamJqaG5jb3Y0MHVpMnFxZ3IzN3NhbGwzIn0.giv88MrlUsX2WznylrLvwA";
      const map = new mapboxgl.Map({
        container: "map",
        style: "mapbox://styles/newisland1223/clzig8nrs00l501qqa3yxfgzm",
        center: [114.171, 22.297], // <-- Kowloon; [114.141, 22.495], // Fanling
        zoom: 13.4
      });
      const locations = [
        { name: 'Central', coords: [114.1586, 22.2799] },
        { name: 'Mong Kok', coords: [114.1696, 22.3193] }
      ];
      async function getIsochrone(lon, lat, profile = 'driving', minutes = [5, 10, 15]) {
        const urlBase = 'https://api.mapbox.com/isochrone/v1/mapbox/';
        const query = await fetch(
            `${urlBase}${profile}/${lon},${lat}?contours_minutes=${minutes.join(',')}&polygons=true&access_token=${mapboxgl.accessToken}`,
            { method: 'GET' }
        );
        return await query.json();
      }
      map.on('load', async () => {
          // Colors for different locations
          const colors = ['#5a3fc0', '#04e813']; // Purple for Central, Green for Mong Kok
      
          // Loop through locations
          for (let i = 0; i < locations.length; i++) {
              const loc = locations[i];
              const data = await getIsochrone(loc.coords[0], loc.coords[1], 'walking', [5, 10, 15]);
      
              // Add GeoJSON source
              map.addSource(`iso-${loc.name}`, {
                  type: 'geojson',
                  data: data
              });
      
              // Add fill layer for isochrones
              map.addLayer({
                  id: `isoLayer-${loc.name}`,
                  type: 'fill',
                  source: `iso-${loc.name}`,
                  layout: {},
                  paint: {
                      'fill-color': colors[i],
                      'fill-opacity': 0.3 // Transparency to see overlaps
                  }
              });
      
              // Add marker for the location
              new mapboxgl.Marker()
                  .setLngLat(loc.coords)
                  .addTo(map);
          }
      });
    </script>
  </body>
</html>
