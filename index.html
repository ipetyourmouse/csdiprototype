<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Demo: Create interactive hover effects with Mapbox GL JS</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.js"></script>
    <link
      href="https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.css"
      rel="stylesheet"
    />
    <style>
      body {
        margin: 0;
        padding: 0;
      }

      #map {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 100%;
      }

      .quake-info {
        position: absolute;
        font-family: sans-serif;
        margin-top: 5px;
        margin-left: 5px;
        padding: 5px;
        width: 30%;
        border: 2px solid black;
        font-size: 14px;
        color: #222;
        background-color: #fff;
        border-radius: 3px;
      }
    </style>
  </head>

  <body>
    <div id="map"></div>
    <div class="quake-info">
      <div><strong>Magnitude:</strong>&nbsp;<span id="NameTC"></span></div>
      <div><strong>Location:</strong>&nbsp;<span id="AddressTC"></span></div>
      <div><strong>Date:</strong>&nbsp;<span id="DistrictTC"></span></div>
    </div>

    <script>
      mapboxgl.accessToken = 'pk.eyJ1IjoibmV3aXNsYW5kMTIyMyIsImEiOiJjamJqaG5jb3Y0MHVpMnFxZ3IzN3NhbGwzIn0.giv88MrlUsX2WznylrLvwA';
      const map = new mapboxgl.Map({
        container: 'map', // Specify the container ID
        style: 'mapbox://styles/newisland1223/clzig8nrs00l501qqa3yxfgzm', // Specify which map style to use
        center: [114.141, 22.495], // Specify the starting position [lng, lat]
        zoom: 13.4 // Specify the starting zoom
      });

      // We only want to return earthquakes that happened in the last week
      // Use JavaScript to get today's date
      const today = new Date();
      // Use JavaScript to get the date a week ago
      const priorDate = new Date().setDate(today.getDate() - 7);
      // Set that to an ISO8601 timestamp as required by the USGS earthquake API
      const priorDateTs = new Date(priorDate);
      const sevenDaysAgo = priorDateTs.toISOString();

      // Target the span elements used in the sidebar
      const magDisplay = document.getElementById('mag');
      const locDisplay = document.getElementById('loc');
      const dateDisplay = document.getElementById('date');

      map.on('load', () => {
        // When the map loads, add the data from the USGS earthquake API as a source
        map.addLayer({
          'id': 'parks',
          'source': 'csdi_os',
          'source-layer': 'csdi_os',
          'type': 'symbol',
            'layout': {
              'icon-image': 'dot-10',
              'icon-size': 0.5
            }
          'generateId': true // This ensures that all features have unique IDs
          'paint': {
              'icon-color': '#0000FF'
          }
        });

        // Add earthquakes as a layer and style it
        map.addLayer({
          'id': 'park-viz',
          'type': 'circle',
          'source': 'parks',
          'paint': {
            // The feature-state dependent circle-radius expression will render
            // the radius size according to its magnitude when
            // a feature's hover state is set to true
            'circle-radius': [
              'case',
              ['boolean', ['feature-state', 'hover'], false],
              10,
              5
            ],
            'circle-stroke-color': '#000',
            'circle-stroke-width': 1,
            // The feature-state dependent circle-color expression will render
            // the color according to its magnitude when
            // a feature's hover state is set to true
            'circle-color': [
              'case',
              ['boolean', ['feature-state', 'hover'], false],
              [
                'interpolate',
                ['linear'],
                ['get', 'GeometryLatitude'],
                22.05,
                '#fff7ec',
                22.1,
                '#fee8c8',
                22.15,
                '#fdd49e',
                22.2,
                '#fdbb84',
                22.25,
                '#fc8d59',
                22.3,
                '#ef6548',
                22.35,
                '#d7301f',
                22.4,
                '#b30000',
                22.45,
                '#7f0000',
                22.5,
                '#000'
              ],
              '#000'
            ]
          }
        });

        let quakeID = null;

        map.on('mousemove', 'parks-viz', (event) => {
          map.getCanvas().style.cursor = 'pointer';
          // Set variables equal to the current feature's magnitude, location, and time
          const quakeMagnitude = event.features[0].properties.mag;
          const quakeLocation = event.features[0].properties.place;
          const quakeDate = new Date(event.features[0].properties.time);

          if (event.features.length === 0) return;
          // Display the magnitude, location, and time in the sidebar
          magDisplay.textContent = quakeMagnitude;
          locDisplay.textContent = quakeLocation;
          dateDisplay.textContent = quakeDate;

          // When the mouse moves over the earthquakes-viz layer, update the
          // feature state for the feature under the mouse
          if (quakeID) {
            map.removeFeatureState({
              source: 'parks',
              id: quakeID
            });
          }

          quakeID = event.features[0].id;

          map.setFeatureState(
            {
              source: 'parks',
              id: quakeID
            },
            {
              hover: true
            }
          );
        });

        // When the mouse leaves the earthquakes-viz layer, update the
        // feature state of the previously hovered feature
        map.on('mouseleave', 'parks-viz', () => {
          if (quakeID) {
            map.setFeatureState(
              {
                source: 'parks',
                id: quakeID
              },
              {
                hover: false
              }
            );
          }
          quakeID = null;
          // Remove the information from the previously hovered feature from the sidebar
          magDisplay.textContent = '';
          locDisplay.textContent = '';
          dateDisplay.textContent = '';
          // Reset the cursor style
          map.getCanvas().style.cursor = '';
        });
      });
    </script>
  </body>
</html>
