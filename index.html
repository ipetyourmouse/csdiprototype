<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>For CSDI use</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://api.tiles.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.js"></script>
    <link href="https://api.tiles.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Inter" rel="stylesheet" />
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        .box { line-height: 0.9; }
        #control-panel {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            font-family: Arial, sans-serif;
            font-size: 14px;
            z-index: 1;
        }
        #tab-bar {
            position: absolute;
            top: 110px;
            left: 10px;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            font-family: Arial, sans-serif;
            font-size: 14px;
            display: none;
            z-index: 1;
        }
        /* Custom marker styling for hover */
        .mapboxgl-marker svg path {
            fill: #3FB1CE; /* Default color matching isochrone */
        }
        .mapboxgl-marker.hovered svg path {
            fill: #FF0000; /* Red on hover */
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div id='control-panel'>
        <form>
            <label><input type="radio" name="location-set" value="parks" checked> Open space</label><br>
            <label><input type="radio" name="location-set" value="leisure"> Leisure facilities</label><br>
            <label><input type="radio" name="location-set" value="malls"> Shopping centres</label>
        </form>
        <span><a href="https://ipetyourmouse.github.io/csdihome">Back</a></span>
    </div>
    <div id='tab-bar'></div>
    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoibmV3aXNsYW5kMTIyMyIsImEiOiJjamJqaG5jb3Y0MHVpMnFxZ3IzN3NhbGwzIn0.giv88MrlUsX2WznylrLvwA';

        if (!mapboxgl) {
            console.error('Mapbox GL JS failed to load. Check the script source.');
            throw new Error('Mapbox GL JS not available');
        }

        const map = new mapboxgl.Map({
            container: "map",
            style: "mapbox://styles/newisland1223/clzig8nrs00l501qqa3yxfgzm",
            center: [114.0708511, 22.4747884], // Default center
            zoom: 11
        });

      const locationSets = {
        parks: [
          { name: 'Cheung Lung Wai Estate', coords: [114.12350000000004, 22.49490000000003] },
          { name: 'Ching Ho Estate', coords: [114.12580000000004, 22.493100000000027] },
          { name: 'Choi Yuen Estate', coords: [114.12580000000004, 22.501700000000028] },
          { name: 'Fai Ming Estate', coords: [114.13610000000006, 22.481100000000023] },
          { name: 'Ka Fuk Estate', coords: [114.13490000000002, 22.49270000000007] },
          { name: 'Po Shek Wu Estate', coords: [114.12430000000006, 22.503300000000024] },
          { name: 'Wah Sum Estate', coords: [114.14320000000008, 22.48580000000004] },
          { name: 'Grandeur Terrace', coords: [114.00240000000008, 22.468800000000044] },
          { name: 'Long Ching Estate', coords: [114.0286000000001, 22.44650000000007] },
          { name: 'Shui Pin Wai Estate', coords: [114.02030000000002, 22.446000000000023] },
          { name: 'Tin Chak Estate', coords: [113.99750000000006, 22.467300000000023] },
          { name: 'Tin Ching Estate', coords: [114.00350000000005, 22.462900000000047] },
          { name: 'Tin Heng Estate', coords: [113.99890000000003, 22.470600000000047] },
          { name: 'Tin Shui (I) Estate, Tin Shui (II) Estate', coords: [113.99868400000004, 22.455341000000036] },
          { name: 'Tin Tsz Estate', coords: [114.00740000000008, 22.452600000000075] },
          { name: 'Tin Wah Estate', coords: [113.9955000000001, 22.46070000000003] },
          { name: 'Tin Yan Estate', coords: [113.9960000000001, 22.46440000000007] },
          { name: 'Tin Yat Estate', coords: [114.00020000000006, 22.46670000000006] },
          { name: 'Tin Yiu (I) Estate, Tin Yiu (II) Estate', coords: [114.00462300000004, 22.451112000000023] },
          { name: 'Tin Yuet Estate', coords: [113.99940000000004, 22.46270000000004] },
          { name: 'Long Ping Estate', coords: [114.02280000000007, 22.449100000000044] },
          { name: 'Cheung Wah Estate', coords: [114.14190000000008, 22.492200000000025] },
          { name: 'Tai Ping Estate', coords: [114.12670000000004, 22.498000000000047] },
          { name: 'Tin Ping Estate', coords: [114.1323000000001, 22.50350000000003] },
          { name: 'Wah Ming Estate', coords: [114.14020000000004, 22.484500000000025] },
          { name: 'Cheong Shing Court', coords: [114.1382000000001, 22.483900000000062] },
          { name: 'Choi Po Court', coords: [114.12430000000006, 22.501100000000065] },
          { name: 'Ka Shing Court', coords: [114.1341000000001, 22.49380000000008] },
          { name: 'King Shing Court', coords: [114.1409000000001, 22.487700000000075] },
          { name: 'On Shing Court', coords: [114.13520000000004, 22.502200000000077] },
          { name: 'Sunningdale Garden', coords: [114.13210000000004, 22.501600000000053] },
          { name: 'Tsui Lai Garden', coords: [114.12830000000008, 22.50830000000008] },
          { name: 'Wing Fai Centre', coords: [114.14320000000008, 22.501600000000053] },
          { name: 'Wing Fok Centre', coords: [114.14040000000011, 22.50130000000007] },
          { name: 'Yan Shing Court', coords: [114.13920000000007, 22.48720000000003] },
          { name: 'Yuk Po Court', coords: [114.12830000000008, 22.499900000000025] },
          { name: 'Yung Shing Court', coords: [114.13800000000003, 22.48280000000005] },
          { name: 'Fung Ting Court', coords: [114.0322000000001, 22.443100000000072] },
          { name: 'Ping Yan Court', coords: [114.00350000000005, 22.44560000000007] },
          { name: 'Tin Chung Court', coords: [114.00030000000004, 22.46070000000003] },
          { name: 'Tin Fu Court', coords: [113.99940000000004, 22.465100000000064] },
          { name: 'Tin Lai Court', coords: [114.00800000000004, 22.452900000000056] },
          { name: 'Tin Oi Court', coords: [113.99790000000009, 22.454000000000065] },
          { name: 'Tin Shing Court', coords: [114.00220000000002, 22.447500000000048] },
          { name: 'Tin Yau Court', coords: [114.00610000000006, 22.451900000000023] },
          { name: 'Wang Fu Court', coords: [114.02820000000008, 22.450800000000072] },
          { name: 'Ching Tao Court', coords: [114.12880000000008, 22.495300000000043] },
          { name: 'North District Park', coords: [114.1341113, 22.49892247] },
          { name: 'The park located east of Fan Kam Road', coords: [114.122099, 22.49502554] },
          { name: 'Tin Tsz Garden', coords: [114.00853, 22.4520446] },
          { name: 'Fung Cheung Road Garden', coords: [114.0326723, 22.44439963] },
          { name: 'Tin Ping Road Garden', coords: [114.1267913, 22.50931355] },
          { name: 'Tai Tau Leng Sitting-out Area', coords: [114.1232912, 22.50028734] },
          { name: 'Yat Ming Road Park', coords: [114.1448732, 22.48556901] },
          { name: 'San Wan Road Sitting-out Area', coords: [114.1364068, 22.49518487] },
          { name: 'Tin Yip Road Park', coords: [114.0074497, 22.46323409] },
          { name: 'Tin Shui Wai Park', coords: [114.0034542, 22.45565875] }
        ],
        malls: [
          { name: 'Wing Fok Centre', coords: [114.14155, 22.501105] },
          { name: 'Yung Shing Shopping Centre', coords: [114.138716, 22.482685] },
          { name: 'Wing Fai Centre Commercial Complex', coords: [114.142282, 22.501144] },
          { name: 'Jubilee Plaza', coords: [114.128767, 22.504878] },
          { name: 'YOHO Mall I', coords: [114.037523, 22.445147] },
          { name: 'Fanling Centre Shopping Arcade', coords: [114.140813, 22.491121] },
          { name: '+WOO Phase I', coords: [114.002759, 22.458139] },
          { name: 'Flora Plaza', coords: [114.14137, 22.485395] },
          { name: 'Tin Chak Shopping Centre', coords: [113.998668, 22.468407] },
          { name: 'YOHO Mix', coords: [114.036649, 22.443585] },
          { name: 'Landmark North 2', coords: [114.121441, 22.504775] },
          { name: 'Wah Sum Shopping Centre', coords: [114.142085, 22.486689] },
          { name: 'Tin Ping Square', coords: [114.133622, 22.503342] },
          { name: 'Tsui Lai Garden Shopping Arcade', coords: [114.129037, 22.507593] },
          { name: 'Dawning Views Plaza', coords: [114.143718, 22.486898] },
          { name: 'Spot', coords: [114.128072, 22.503241] },
          { name: 'Regentville Shopping Centre', coords: [114.143757, 22.500609] },
          { name: 'Union Plaza Shopping Arcade', coords: [114.141604, 22.499966] },
          { name: 'Wah Ming Shopping Centre', coords: [114.141083, 22.484051] },
          { name: 'One Sky Mall', coords: [114.003363, 22.464635] },
          { name: 'Landmark North', coords: [114.127861, 22.50255] },
          { name: 'Ka Fuk Shopping Centre', coords: [114.135459, 22.49361] },
          { name: 'K Plus', coords: [114.028718, 22.441331] },
          { name: 'Choi Yuen Plaza', coords: [114.126438, 22.500604] },
          { name: 'Ching Ho Shopping Centre', coords: [114.128187, 22.494335] },
          { name: 'YOHO Mall II', coords: [114.035116, 22.445496] },
          { name: '+WOO Phase II', coords: [114.004227, 22.457195] },
          { name: 'Yuen Long Plaza', coords: [114.023984, 22.444957] },
          { name: 'Metropolis Plaza', coords: [114.129181, 22.502101] },
          { name: 'Tin Yan Shopping Centre', coords: [113.996228, 22.462448] },
          { name: 'Ping Yan Shopping Centre', coords: [114.004262, 22.445932] },
          { name: 'Cheung Lung Lane', coords: [114.123973, 22.495149] },
          { name: 'T Town North', coords: [113.997838, 22.462448] },
          { name: 'Kingswood Richly Plaza', coords: [114.000385, 22.452083] },
          { name: 'Avon Mall', coords: [114.142756, 22.487748] },
          { name: 'Tin Yiu Plaza', coords: [114.003535, 22.450664] },
          { name: 'One North', coords: [114.029467, 22.450794] },
          { name: 'Long Ping Commercial Complex', coords: [114.023246, 22.450312] },
          { name: 'Sheung Shui Centre', coords: [114.129859, 22.500943] },
          { name: 'Citistore', coords: [114.028505, 22.442623] },
          { name: 'Green Code Plaza', coords: [114.145994, 22.500903] },
          { name: 'Fanling Town Centre Shopping Arcade', coords: [114.13955, 22.492335] },
          { name: 'Tin Tsz Shopping Centre', coords: [114.006936, 22.453194] },
          { name: 'Cheung Wah Shopping Centre', coords: [114.14048, 22.493193] },
          { name: 'Tin Shing Shopping Centre', coords: [114.002791, 22.448958] },
          { name: 'Tin Shui Shopping Centre', coords: [113.998425, 22.455951] },
          { name: 'YOHO Plus', coords: [114.031835, 22.443741] },
          { name: 'T Town South', coords: [113.997798, 22.461466] },
          { name: 'Sheung Shui Town Centre Shopping Arcade', coords: [114.131572, 22.501048] },
          { name: 'Tin Ching Shopping Centre', coords: [114.003436, 22.46245] }
        ],
        leisure: [
          { name: "Yuen Long Children's Playground", coords: [114.02695407, 22.44367905 ] },
          { name: "On Lok Tsuen Playground", coords: [114.14338506, 22.49719805 ] },
          { name: "Shui Pin Tsuen Playground", coords: [114.02168929, 22.44408225 ] },
          { name: "Tung Tau Industrial Area Playground", coords: [114.03030425, 22.44957628 ] },
          { name: "Ma Tin Road 5-a-side Football Pitch", coords: [114.02387416, 22.44137611 ] },
          { name: "Fanling Temporary Tennis Court", coords: [114.13919687, 22.49567912 ] },
          { name: "On Hing Playground", coords: [114.02432512, 22.44206917 ] },
          { name: "Tin Ho Road Playground", coords: [114.00034696, 22.44973414 ] },
          { name: "Wo Muk Road Playground", coords: [114.14213736, 22.50057154 ] },
          { name: "Kik Yeung Road 5-a-side Football Pitch", coords: [114.0254358, 22.4453591 ] },
          { name: "Shek Wu Hui Playground", coords: [114.12810853, 22.50358948 ] },
          { name: "Luen Wo Hui Playground", coords: [114.14249588, 22.49700281 ] },
          { name: "Wo Hing Playground", coords: [114.1432677, 22.48416354 ] },
          { name: "Po Wing Road Playground", coords: [114.12779891, 22.49691773 ] },
          { name: "Pak Fuk Tin Sum Playground", coords: [114.14039785, 22.48900593 ] },
          { name: "Pak Fuk Children's Playground", coords: [114.13367434, 22.49462208 ] },
          { name: "Fan Ling Wai Playground", coords: [114.13613616, 22.49719367 ] },
          { name: "Fan Leng Lau Road Playground", coords: [114.14077874, 22.5004087 ] },
          { name: "On Fuk Street Playground", coords: [114.14518425, 22.49575084 ] },
          { name: "Tai Tau Leng Playground", coords: [114.12334269, 22.50044268 ] },
          { name: "Tin Sau Road Park", coords: [114.00169924, 22.46600209 ] },
          { name: "Chung Sing Path Playground", coords: [114.02611874, 22.44356087 ] },
          { name: "Fung Kwan Street Garden", coords: [114.03414514, 22.4423906 ] },
          { name: "Kin Yip Street Playground", coords: [114.03162088, 22.44280917 ] },
          { name: "Tai Kiu Market Sitting-out Area", coords: [114.02697286, 22.44517631 ] },
          { name: "Tin Pak Road Park", coords: [114.00771039, 22.45737543 ] },
          { name: "Town Park South Playground", coords: [114.018175, 22.43941823 ] },
          { name: "Pak Wo Road Playground", coords: [114.13301045, 22.49197961 ] },
          { name: "North District Sports Ground", coords: [114.13060000000009, 22.506300000000067 ] },
          { name: "Fanling Recreation Ground", coords: [114.13770000000012, 22.49350000000004 ] },
          { name: "Long Ping Sports Centre", coords: [114.02320000000007, 22.450300000000027 ] },
          { name: "Yuen Long Sports Centre", coords: [114.02390000000004, 22.44150000000008 ] },
          { name: "Tin Fai Road Sports Centre", coords: [113.99700000000009, 22.464800000000025 ] },
          { name: "Po Wing Road Sports Centre", coords: [114.12830000000008, 22.49700000000007 ] },
          { name: "Ping Shan Tin Shui Wai Sports Centre", coords: [114.00470000000008, 22.447400000000076 ] },
          { name: "Tin Shui Sports Centre", coords: [113.99800000000003, 22.454800000000034 ] },
          { name: "Tin Shui Wai Sports Centre", coords: [114.00650000000007, 22.45500000000004 ] },
          { name: "Lung Sum Avenue Sports Centre", coords: [114.1304, 22.50500000000005 ] },
          { name: "Fung Kam Street Sports Centre", coords: [114.03300000000002, 22.443100000000072 ] },
          { name: "Tin Ping Sports Centre", coords: [114.13360000000011, 22.503300000000024 ] },
          { name: "Wo Hing Sports Centre", coords: [114.14310000000012, 22.484800000000064 ] },
          { name: "North District Park", coords: [114.1341000000001, 22.49890000000005 ] },
          { name: "Tin Shui Wai Park", coords: [114.00350000000005, 22.45570000000004 ] },
          { name: "Pak Wo Road Basketball Court", coords: [114.13290000000006, 22.49150000000003 ] },
          { name: "Wo Hing Playground", coords: [114.14330000000008, 22.484200000000044 ] },
          { name: "Shek Wu Hui Playground", coords: [114.12810000000002, 22.503600000000063 ] },
          { name: "Fan Ling Wai Playground", coords: [114.13610000000006, 22.49720000000008 ] },
          { name: "Tin Sau Road Park", coords: [114.00170000000004, 22.466000000000065 ] },
          { name: "Chung Sing Path Playground", coords: [114.02610000000004, 22.44360000000006 ] },
          { name: "Fung Kwan Street Garden", coords: [114.03410000000008, 22.44240000000008 ] },
          { name: "Kin Yip Street Playground", coords: [114.03160000000004, 22.442800000000037 ] },
          { name: "Tin Pak Road Park", coords: [114.00770000000011, 22.457400000000064 ] },
          { name: "Town Park South Playground", coords: [114.01820000000008, 22.439400000000035 ] },
          { name: "Yuen Long Children's Playground", coords: [114.02700000000004, 22.443700000000035 ] },
          { name: "On Lok Tsuen Playground", coords: [114.14340000000004, 22.49720000000008 ] },
          { name: "Shui Pin Tsuen Playground", coords: [114.0217, 22.44410000000005 ] },
          { name: "Tung Tau Industrial Area Playground", coords: [114.0303, 22.449600000000032 ] },
          { name: "Tin Shui Estate(Mobile Library 10)", coords: [113.99894388, 22.45524386 ] },
          { name: "Fanling South Public Library", coords: [114.14349238, 22.48719772 ] },
          { name: "Sheung Shui Public Library", coords: [114.13074959, 22.50216165 ] },
          { name: "Tin Shui Wai North Public Library", coords: [113.99866764, 22.46842253 ] },
          { name: "Cheong Shing Court(Mobile Library 12)", coords: [114.13853347, 22.48379766 ] },
          { name: "Tin Wah Estate(Mobile Library 11)", coords: [113.99660801, 22.46073537 ] },
          { name: "Kingswood Country Club(Mobile Library 3)", coords: [114.00607696, 22.45916625 ] },
          { name: "Ching Ho Estate(Mobile Library 10)", coords: [114.12506749, 22.49325866 ] },
          { name: "Fanling Public Library", coords: [114.144424, 22.5001177 ] },
          { name: "Yuen Long Public Library", coords: [114.02390141, 22.44133008 ] },
          { name: "Ka Fuk Estate(Mobile Library 12)", coords: [114.13473613, 22.49273501 ] },
          { name: "Ping Shan Tin Shui Wai Public Library", coords: [114.00473715, 22.44737923 ] },
          { name: "Tin Yuet Estate(Mobile Library 10)", coords: [113.99903834, 22.46268773 ] },
          { name: "Fung Cheung Road(Mobile Library 10)", coords: [114.03259658, 22.4433916 ] },
          { name: "Tin Ching Estate(Mobile Library 3)", coords: [114.00482961, 22.46377946 ] },
          { name: "North District Park", coords: [114.1341000000001, 22.49890000000005 ] },
          { name: "Tin Shui Wai Park", coords: [114.00350000000005, 22.45570000000004 ] },
          { name: "Yuen Long Park", coords: [114.01890000000004, 22.44250000000005 ] },
          { name: "Luen Wo Hui Playground", coords: [114.14250000000004, 22.49700000000007 ] },
          { name: "Shek Wu Hui Playground", coords: [114.12810000000002, 22.503600000000063 ] },
          { name: "Po Wing Road Playground", coords: [114.1278000000001, 22.49690000000004 ] },
          { name: "Tai Tau Leng Playground", coords: [114.12330000000009, 22.50040000000007 ] },
          { name: "Tin Sau Road Park", coords: [114.00170000000004, 22.466000000000065 ] },
          { name: "Pak Wo Road Playground", coords: [114.13300000000004, 22.492000000000075 ] },
          { name: "On Lok Tsuen Playground", coords: [114.14340000000004, 22.49720000000008 ] },
          { name: "Shui Pin Tsuen Playground", coords: [114.0217, 22.44410000000005 ] },
          { name: "Tung Tau Industrial Area Playground", coords: [114.0303, 22.449600000000032 ] },
          { name: "On Hing Playground", coords: [114.02430000000004, 22.44210000000004 ] },
          { name: "Tin Ho Road Playground", coords: [114.00030000000004, 22.449700000000064 ] },
          { name: "Wo Muk Road Playground", coords: [114.14210000000004, 22.50060000000008 ] },
          { name: "Kik Yeung Road 5-a-side Football Pitch", coords: [114.0254000000001, 22.445400000000063 ] },
          { name: "Long Ping Sports Centre", coords: [114.02320000000007, 22.450300000000027 ] },
          { name: "Yuen Long Sports Centre", coords: [114.02390000000004, 22.44150000000008 ] },
          { name: "Tin Fai Road Sports Centre", coords: [113.99700000000009, 22.464800000000025 ] },
          { name: "Po Wing Road Sports Centre", coords: [114.12830000000008, 22.49700000000007 ] },
          { name: "Ping Shan Tin Shui Wai Sports Centre", coords: [114.00470000000008, 22.447400000000076 ] },
          { name: "Luen Wo Hui Sports Centre", coords: [114.1450000000001, 22.50030000000004 ] },
          { name: "Tin Shui Sports Centre", coords: [113.99800000000003, 22.454800000000034 ] },
          { name: "Lung Sum Avenue Sports Centre", coords: [114.1304, 22.50500000000005 ] },
          { name: "Fung Kam Street Sports Centre", coords: [114.03300000000002, 22.443100000000072 ] },
          { name: "Tin Ping Sports Centre", coords: [114.13360000000011, 22.503300000000024 ] },
          { name: "Wo Hing Sports Centre", coords: [114.14310000000012, 22.484800000000064 ] },
          { name: "Pau Cheung Square Playground", coords: [114.02960000000007, 22.44550000000004 ] },
          { name: "Long Ping Sports Centre", coords: [114.02320000000007, 22.450300000000027 ] },
          { name: "Yuen Long Sports Centre", coords: [114.02390000000004, 22.44150000000008 ] },
          { name: "Tin Fai Road Sports Centre", coords: [113.99700000000009, 22.464800000000025 ] },
          { name: "Po Wing Road Sports Centre", coords: [114.12830000000008, 22.49700000000007 ] },
          { name: "Ping Shan Tin Shui Wai Sports Centre", coords: [114.00470000000008, 22.447400000000076 ] },
          { name: "Tin Shui Sports Centre", coords: [113.99800000000003, 22.454800000000034 ] },
          { name: "Tin Shui Wai Sports Centre", coords: [114.00650000000007, 22.45500000000004 ] },
          { name: "Lung Sum Avenue Sports Centre", coords: [114.1304, 22.50500000000005 ] },
          { name: "Fung Kam Street Sports Centre", coords: [114.03300000000002, 22.443100000000072 ] },
          { name: "Tin Ping Sports Centre", coords: [114.13360000000011, 22.503300000000024 ] },
          { name: "Wo Hing Sports Centre", coords: [114.14310000000012, 22.484800000000064 ] },
          { name: "Tai Tau Leng Sitting-out Area", coords: [114.12330000000009, 22.50030000000004 ] },
          { name: "Pak Fuk Children's Playground", coords: [114.13370000000008, 22.494600000000048 ] },
          { name: "Tai Kiu Market Sitting-out Area", coords: [114.02700000000004, 22.445200000000057 ] },
          { name: "Long Ping Sports Centre", coords: [114.02320000000007, 22.450300000000027 ] },
          { name: "Yuen Long Sports Centre", coords: [114.02390000000004, 22.44150000000008 ] },
          { name: "Tin Fai Road Sports Centre", coords: [113.99700000000009, 22.464800000000025 ] },
          { name: "Po Wing Road Sports Centre", coords: [114.12830000000008, 22.49700000000007 ] },
          { name: "Ping Shan Tin Shui Wai Sports Centre", coords: [114.00470000000008, 22.447400000000076 ] },
          { name: "Luen Wo Hui Sports Centre", coords: [114.1450000000001, 22.50030000000004 ] },
          { name: "Tin Shui Sports Centre", coords: [113.99800000000003, 22.454800000000034 ] },
          { name: "Tin Shui Wai Sports Centre", coords: [114.00650000000007, 22.45500000000004 ] },
          { name: "Lung Sum Avenue Sports Centre", coords: [114.1304, 22.50500000000005 ] },
          { name: "Fung Kam Street Sports Centre", coords: [114.03300000000002, 22.443100000000072 ] },
          { name: "Tin Ping Sports Centre", coords: [114.13360000000011, 22.503300000000024 ] },
          { name: "Wo Hing Sports Centre", coords: [114.14310000000012, 22.484800000000064 ] },
          { name: "Chung Sing Path Playground", coords: [114.026111, 22.443611000000036 ] },
          { name: "Fung Kwan Street Garden", coords: [114.03416700000002, 22.44250000000005 ] },
          { name: "Kin Yip Street Playground", coords: [114.03166700000008, 22.442778000000036 ] },
          { name: "Shui Pin Tsuen Playground", coords: [114.0216670000001, 22.44416700000005 ] },
          { name: "Tin Pak Road Park", coords: [114.00777800000004, 22.45722200000006 ] },
          { name: "Town Park South Playground", coords: [114.01805600000012, 22.43944400000004 ] },
          { name: "Fanling Recreation Ground", coords: [114.13777800000004, 22.493611000000044 ] },
          { name: "North District Park", coords: [114.13416700000003, 22.49888900000008 ] },
          { name: "North District Sports Ground", coords: [114.13055600000008, 22.50638900000007 ] },
          { name: "Wo Hing Playground", coords: [114.1433330000001, 22.48416700000007 ] },
          { name: "Tin Sau Road Park", coords: [114.00166700000013, 22.46611100000007 ] },
          { name: "Long Ping Sports Centre", coords: [114.02320000000007, 22.450300000000027 ] },
          { name: "Tin Shui Wai Sports Centre", coords: [114.00650000000007, 22.45500000000004 ] },
          { name: "Lung Sum Avenue Sports Centre", coords: [114.1304, 22.50500000000005 ] },
          { name: "Wo Hing Sports Centre", coords: [114.14310000000012, 22.484800000000064 ] },
          { name: "Yuen Long Jockey Club Squash Courts", coords: [114.03010000000006, 22.440900000000056 ] },
          { name: "Tai Kiu Market Squash Courts", coords: [114.02740000000006, 22.445200000000057 ] },
          { name: "Yuen Long Sir Denys Roberts Squash Court", coords: [114.0226, 22.446900000000028 ] },
          { name: "North District Sports Ground", coords: [114.13060000000009, 22.506300000000067 ] },
          { name: "Yuen Long Stadium", coords: [114.02130000000012, 22.44240000000008 ] },
          { name: "Tin Shui Wai Sports Ground", coords: [114.00500000000012, 22.454600000000028 ] },
          { name: "Fanling Recreation Ground", coords: [114.13770000000012, 22.49350000000004 ] },
          { name: "Tin Yip Road Park", coords: [114.00740000000008, 22.46320000000003 ] },
          { name: "Pak Fuk Tin Sum Playground", coords: [114.14040000000011, 22.489000000000036 ] },
          { name: "North District Sports Ground", coords: [114.13060000000009, 22.506300000000067 ] },
          { name: "Wo Hing Sports Centre", coords: [114.14310000000012, 22.484800000000064 ] },
          { name: "Tin Shui Wai Park", coords: [114.00350000000005, 22.45570000000004 ] },
          { name: "Sai Ching Street Tennis Courts", coords: [114.02720000000012, 22.44160000000005 ] },
          { name: "North District Sports Ground", coords: [114.13060000000009, 22.506300000000067 ] },
          { name: "Yuen Long Stadium", coords: [114.02130000000012, 22.44240000000008 ] },
          { name: "Tin Shui Wai Sports Ground", coords: [114.00500000000012, 22.454600000000028 ] },
          { name: "Fanling Recreation Ground", coords: [114.13770000000012, 22.49350000000004 ] },
          { name: "Yuen Long Theatre", coords: [114.02282296, 22.44146451 ] },
          { name: "North District Town Hall", coords: [114.1288352, 22.50163733 ] },
          { name: "Po Wing Road Sports Centre", coords: [114.12839948, 22.49696848 ] },
          { name: "Tin Fai Road Sports Centre", coords: [113.99702152, 22.4647959 ] },
          { name: "Tin Yip Road Artificial Sand Court", coords: [114.00641400000006, 22.46439900000007 ] },
          { name: "Tin Sau Road Swimming Pool", coords: [114.00266412, 22.46710912 ] },
          { name: "Sheung Shui Swimming Pool", coords: [114.13134014, 22.50619027 ] },
          { name: "Fanling Swimming Pool", coords: [114.1360931, 22.49490626 ] },
          { name: "Ping Shan Tin Shui Wai Swimming Pool", coords: [114.00467401, 22.44737013 ] },
          { name: "Yuen Long Swimming Pool", coords: [114.02138633, 22.44134664 ] },
          { name: "Tin Shui Wai Swimming Pool", coords: [114.00691421, 22.45617355 ] }
          
        ]
      };
        const modeOfTravel = 'walking';
        const chosenMinutes = [2, 6, 10];
        const colorForOpenSpace = '#3FB1CE';
        const colorHovered = '#FF0000';
        let currentMarkers = [];
        let currentSources = [];
        let currentLayers = [];

        async function getIsochrone(lon, lat, profile = modeOfTravel, minutes = chosenMinutes) {
            try {
                const urlBase = 'https://api.mapbox.com/isochrone/v1/mapbox/';
                const query = await fetch(
                    `${urlBase}${profile}/${lon},${lat}?contours_minutes=${minutes.join(',')}&polygons=true&access_token=${mapboxgl.accessToken}`,
                    { method: 'GET' }
                );
                if (!query.ok) {
                    throw new Error(`Isochrone API request failed: ${query.statusText}`);
                }
                return await query.json();
            } catch (error) {
                console.error(`Error fetching isochrone for ${lon}, ${lat}:`, error);
                return null;
            }
        }

        function clearMap() {
            currentMarkers.forEach(marker => marker.remove());
            currentMarkers = [];
            currentLayers.forEach(layerId => {
                if (map.getLayer(layerId)) map.removeLayer(layerId);
            });
            currentSources.forEach(sourceId => {
                if (map.getSource(sourceId)) map.removeSource(sourceId);
            });
            currentLayers = [];
            currentSources = [];
            document.getElementById('tab-bar').style.display = 'none';
        }

        async function loadLocationSet(setKey) {
            clearMap();
            const locations = locationSets[setKey];
            console.log(`Loading ${setKey} with ${locations.length} locations`);

            for (let i = 0; i < locations.length; i++) {
                const loc = locations[i];
                console.log(`Processing location: ${loc.name}`);

                const data = await getIsochrone(loc.coords[0], loc.coords[1]);
                if (!data) {
                    console.error(`No isochrone data for ${loc.name}`);
                    continue;
                }

                const sourceId = `iso-${loc.name}-${i}`; // Unique source ID
                const layerId = `isoLayer-${loc.name}-${i}`; // Unique layer ID
                map.addSource(sourceId, {
                    type: 'geojson',
                    data: data
                });
                currentSources.push(sourceId);

                map.addLayer({
                    id: layerId,
                    type: 'fill',
                    source: sourceId,
                    layout: { 'visibility': 'visible' },
                    paint: {
                        'fill-color': colorForOpenSpace,
                        'fill-opacity': 0.075
                    }
                });
                currentLayers.push(layerId);

                const marker = new mapboxgl.Marker({
                    scale: 0.5,
                    color: colorForOpenSpace
                })
                    .setLngLat(loc.coords)
                    .addTo(map);
                currentMarkers.push(marker);
                console.log(`Marker created for ${loc.name}`);

                const markerElement = marker.getElement();
                if (!markerElement) {
                    console.error(`Marker element not found for ${loc.name}`);
                    continue;
                }
                markerElement.style.cursor = 'pointer';
                markerElement.addEventListener('mouseover', () => {
                    console.log(`Hovering over ${loc.name}`);
                    const tabBar = document.getElementById('tab-bar');
                    tabBar.textContent = loc.name;
                    tabBar.style.display = 'block';

                    markerElement.classList.add('hovered');
                    map.setPaintProperty(layerId, 'fill-color', colorHovered);

                    locations.forEach((otherLoc, j) => {
                        const otherLayerId = `isoLayer-${otherLoc.name}-${j}`;
                        map.setLayoutProperty(
                            otherLayerId,
                            'visibility',
                            otherLoc.name === loc.name ? 'visible' : 'none'
                        );
                    });
                });

                markerElement.addEventListener('mouseleave', () => {
                    console.log(`Mouse out from ${loc.name}`);
                    document.getElementById('tab-bar').style.display = 'none';
                    markerElement.classList.remove('hovered');
                    map.setPaintProperty(layerId, 'fill-color', colorForOpenSpace);
                    locations.forEach((otherLoc, j) => {
                        const otherLayerId = `isoLayer-${otherLoc.name}-${j}`;
                        map.setLayoutProperty(otherLayerId, 'visibility', 'visible');
                    });
                });
            }
        }

        map.on('load', async () => {
            await loadLocationSet('parks');

            const radioButtons = document.querySelectorAll('input[name="location-set"]');
            radioButtons.forEach(radio => {
                radio.addEventListener('change', (e) => {
                    const setKey = e.target.value;
                    console.log(`Switching to location set: ${setKey}`);
                    loadLocationSet(setKey);
                });
            });
        });

        map.on('error', (e) => {
            console.error('Map load error:', e);
        });
    </script>
</body>
</html>
